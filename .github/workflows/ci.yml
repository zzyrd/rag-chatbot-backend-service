# .github/workflows/ci.yml
name: CI

on:
  pull_request:
  push:
    branches:
      - main

jobs:
  lint-and-test:
    runs-on: ubuntu-latest
    env:
      OPENAI_API_KEY: 'OPENAI_API_KEY'
      OPENAI_EMBEDDING_MODEL: 'OPENAI_EMBEDDING_MODEL'
      OPENAI_EMBEDDING_MAX_INPUT: 'OPENAI_EMBEDDING_MAX_INPUT'
      OPENAI_GPT_MODEL: 'OPENAI_GPT_MODEL'
      OPENAI_GPT_MODEL_MAX_TOKEN: 'OPENAI_GPT_MODEL_MAX_TOKEN'
      PINECONE_API_KEY: 'PINECONE_API_KEY'
      PINECONE_INDEX_NAME: 'PINECONE_INDEX_NAME'
      PINECONE_NAMESPACE: 'PINECONE_NAMESPACE'
      ALLOWED_EXTENSIONS: 'ALLOWED_EXTENSIONS'
      MINIO_ENDPOINT: 'MINIO_ENDPOINT'
      MINIO_BUCKET_NAME: 'MINIO_BUCKET_NAME'
      MINIO_ACCESS_KEY: 'MINIO_ACCESS_KEY'
      MINIO_SECRET_KEY: 'MINIO_SECRET_KEY'
      MINIO_URL_EXPIRE_DAYS: 'MINIO_URL_EXPIRE_DAYS'
      MOCK_OCR_FILES: 'MOCK_OCR_FILES'

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pytest pylint

      - name: Run pylint
        run: |
          python3 -m pylint app --verbose

      - name: Run pytest
        run: |
          python3 -m pytest --verbose
